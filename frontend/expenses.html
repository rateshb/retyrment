<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses - Retyrment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca' },
                        success: { 50: '#ecfdf5', 100: '#d1fae5', 400: '#34d399', 500: '#10b981', 600: '#059669' },
                        warning: { 50: '#fffbeb', 100: '#fef3c7', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
                        danger: { 50: '#fef2f2', 100: '#fee2e2', 400: '#f87171', 500: '#ef4444', 600: '#dc2626' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen bg-pattern">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-white border-r border-slate-200 flex flex-col shadow-sm">
            <div class="p-5 border-b border-slate-200">
                <a href="index.html" class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg logo-gradient flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-primary-500/30">‚Çπ</div>
                    <span class="text-xl font-bold bg-gradient-to-r from-primary-500 to-primary-700 bg-clip-text text-transparent">Retyrment</span>
                </a>
            </div>
            <nav class="flex-1 py-4 overflow-y-auto scrollbar-thin">
                <div class="px-4 mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Overview</div>
                <a href="index.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="dashboard"><span>üìä</span> Dashboard</a>
                <div class="px-4 mt-6 mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Data Entry</div>
                <a href="income.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="income"><span>üí∞</span> Income</a>
                <a href="investments.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="investments"><span>üìà</span> Investments</a>
                <a href="loans.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="loans"><span>üè¶</span> Loans</a>
                <a href="insurance.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="insurance"><span>üõ°Ô∏è</span> Insurance</a>
                <a href="expenses.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="expenses"><span>üõí</span> Expenses</a>
                <a href="goals.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="goals"><span>üéØ</span> Goals</a>
                <div class="px-4 mt-6 mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Analysis</div>
                <a href="calendar.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="calendar"><span>üìÖ</span> Calendar</a>
                <a href="retirement.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="retirement"><span>üèñÔ∏è</span> Retirement</a>
                <a href="reports.html" class="nav-item flex items-center gap-3 px-5 py-3 text-slate-600 border-l-2 border-transparent" data-page="reports"><span>üìë</span> Reports</a>
            </nav>
            <div class="p-4 border-t border-slate-200">
                <a href="preferences.html" class="nav-item flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-slate-700 rounded" data-page="preferences"><span>‚öôÔ∏è</span> Preferences</a>
                <a href="settings.html" class="nav-item flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-slate-700 rounded mt-1" data-page="settings"><span>üîß</span> Settings</a>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto scrollbar-thin">
            <header class="sticky top-0 z-10 header-blur border-b border-slate-200 px-8 py-4">
                <div class="flex justify-between items-center">
                    <div><h1 class="text-2xl font-semibold text-slate-800">Monthly Expenses</h1><p class="text-sm text-slate-500">Track your spending</p></div>
                    <div class="flex gap-3">
                        <button onclick="switchView('table')" id="view-table" class="px-3 py-2 text-sm bg-primary-100 text-primary-700 rounded-lg font-medium">üìã Table</button>
                        <button onclick="switchView('summary')" id="view-summary" class="px-3 py-2 text-sm bg-white text-slate-600 rounded-lg border border-slate-300 hover:bg-slate-50">üìä Summary</button>
                    </div>
                </div>
            </header>

            <div class="p-8">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="card p-4">
                        <div class="text-sm text-slate-500">Total Monthly</div>
                        <div class="text-2xl font-bold text-slate-800" id="total-monthly">‚Çπ0</div>
                        <div class="text-xs text-slate-400" id="total-yearly">‚Çπ0/year</div>
                    </div>
                    <div class="card p-4 border-blue-200 bg-blue-50">
                        <div class="text-sm text-blue-600">Fixed Expenses</div>
                        <div class="text-2xl font-bold text-blue-700" id="fixed-total">‚Çπ0</div>
                        <div class="text-xs text-blue-500" id="fixed-count">0 items</div>
                    </div>
                    <div class="card p-4 border-amber-200 bg-amber-50">
                        <div class="text-sm text-amber-600">Variable Expenses</div>
                        <div class="text-2xl font-bold text-amber-700" id="variable-total">‚Çπ0</div>
                        <div class="text-xs text-amber-500" id="variable-count">0 items</div>
                    </div>
                    <div class="card p-4 border-purple-200 bg-purple-50">
                        <div class="text-sm text-purple-600">Time-Bound (Ending)</div>
                        <div class="text-2xl font-bold text-purple-700" id="timebound-total">‚Çπ0</div>
                        <div class="text-xs text-purple-500" id="timebound-count">0 items</div>
                    </div>
                </div>

                <!-- Investment Opportunity Alert (shown when time-bound expenses exist) -->
                <div id="investment-opportunity-banner" class="hidden mb-6 card p-4 border-emerald-200 bg-gradient-to-r from-emerald-50 to-teal-50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="text-3xl">üí°</div>
                            <div>
                                <h3 class="font-semibold text-emerald-800">Investment Opportunity Detected!</h3>
                                <p class="text-sm text-emerald-600" id="opportunity-message">You have expenses ending before retirement that can be converted to investments.</p>
                            </div>
                        </div>
                        <a href="retirement.html#strategy" class="px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700">
                            View in Strategy Planner ‚Üí
                        </a>
                    </div>
                </div>

                <!-- Table View -->
                <div id="table-view">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex gap-3">
                            <select id="filter-category" onchange="filterExpenses()" class="px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm">
                                <option value="">All Categories</option>
                            </select>
                            <select id="filter-type" onchange="filterExpenses()" class="px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm">
                                <option value="">All Types</option>
                                <option value="fixed">Fixed Only</option>
                                <option value="variable">Variable Only</option>
                                <option value="timebound">Time-Bound Only</option>
                                <option value="recurring">Recurring Only</option>
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <div class="text-sm text-slate-500" id="entry-count">0 entries</div>
                            <button onclick="openAddModal()" class="px-4 py-2 btn-primary rounded-lg flex items-center gap-2 shadow-md"><span>+</span> Add Expense</button>
                        </div>
                    </div>

                    <div class="card overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Category</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Description</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Amount</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Frequency</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">End Date</th>
                                    <th class="px-4 py-3 text-right text-xs font-semibold text-slate-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100" id="data-table">
                                <tr><td colspan="7" class="px-6 py-8 text-center text-slate-400">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Summary View -->
                <div id="summary-view" class="hidden">
                    <!-- Category Breakdown -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">üìä By Category</h3>
                            <div id="category-breakdown" class="space-y-3"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ By Dependent</h3>
                            <div id="dependent-breakdown" class="space-y-3">
                                <div class="text-slate-400 text-sm">No dependent-linked expenses</div>
                            </div>
                        </div>
                    </div>

                    <!-- Time-Bound Expenses Timeline -->
                    <div class="card p-6 mb-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">üìÖ Expense Timeline (Time-Bound)</h3>
                        <p class="text-sm text-slate-500 mb-4">Expenses that will end before or at retirement, creating investment opportunities</p>
                        <div id="expense-timeline" class="space-y-4">
                            <div class="text-slate-400 text-sm">No time-bound expenses</div>
                        </div>
                    </div>

                    <!-- Expense Projection -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">üìà Expense Projection</h3>
                        <p class="text-sm text-slate-500 mb-4">How your expenses will change over time</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-100">
                                    <tr>
                                        <th class="px-3 py-2 text-left text-slate-600">Year</th>
                                        <th class="px-3 py-2 text-right text-slate-600">Monthly</th>
                                        <th class="px-3 py-2 text-right text-slate-600">Yearly</th>
                                        <th class="px-3 py-2 text-right text-slate-600">Freed Up</th>
                                    </tr>
                                </thead>
                                <tbody id="expense-projection-table" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Expense Modal -->
    <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50" style="background: rgba(15, 23, 42, 0.5);">
        <div class="bg-white rounded-xl border border-slate-200 w-full max-w-2xl max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="flex justify-between items-center px-6 py-4 border-b border-slate-200 bg-slate-50">
                <h3 class="text-lg font-semibold text-slate-800" id="modal-title">Add Expense</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
            </div>
            <form id="expense-form" class="p-6 overflow-y-auto max-h-[65vh]" onsubmit="handleSubmit(event)">
                <!-- Basic Info Section -->
                <div class="mb-6">
                    <h4 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                        <span class="w-6 h-6 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-xs">1</span>
                        Basic Information
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-600 mb-1 font-medium">Category <span class="text-danger-500">*</span></label>
                            <select name="category" required class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-slate-800 focus:border-primary-500 text-sm">
                                <option value="">Select Category</option>
                                <optgroup label="Housing">
                                    <option value="RENT">Rent</option>
                                    <option value="UTILITIES">Utilities</option>
                                    <option value="MAINTENANCE">Maintenance</option>
                                    <option value="SOCIETY_CHARGES">Society Charges</option>
                                </optgroup>
                                <optgroup label="Education">
                                    <option value="SCHOOL_FEE">School Fee</option>
                                    <option value="COLLEGE_FEE">College Fee</option>
                                    <option value="TUITION">Tuition/Coaching</option>
                                    <option value="COACHING">Extra Coaching</option>
                                    <option value="BOOKS_SUPPLIES">Books & Supplies</option>
                                    <option value="HOSTEL">Hostel Fees</option>
                                </optgroup>
                                <optgroup label="Childcare">
                                    <option value="CHILDCARE">Childcare</option>
                                    <option value="DAYCARE">Daycare</option>
                                </optgroup>
                                <optgroup label="Daily Living">
                                    <option value="GROCERIES">Groceries</option>
                                    <option value="TRANSPORT">Transport</option>
                                    <option value="HEALTHCARE">Healthcare</option>
                                    <option value="DINING">Dining</option>
                                </optgroup>
                                <optgroup label="Lifestyle">
                                    <option value="ENTERTAINMENT">Entertainment</option>
                                    <option value="SHOPPING">Shopping</option>
                                    <option value="TRAVEL">Travel</option>
                                    <option value="SUBSCRIPTIONS">Subscriptions</option>
                                </optgroup>
                                <optgroup label="Care">
                                    <option value="ELDERLY_CARE">Elderly Care</option>
                                    <option value="INSURANCE_PREMIUM">Insurance Premium</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="OTHER">Other</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-600 mb-1 font-medium">Description <span class="text-danger-500">*</span></label>
                            <input type="text" name="name" required placeholder="e.g., ABC School Annual Fee" class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-slate-800 focus:border-primary-500 text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-4">
                        <div>
                            <label class="block text-sm text-slate-600 mb-1 font-medium">Amount (‚Çπ) <span class="text-danger-500">*</span></label>
                            <input type="number" name="amount" required min="0" step="1" placeholder="75000" 
                                   class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-slate-800 focus:border-primary-500 text-sm"
                                   oninput="updateMonthlyEquivalent()">
                            <div class="text-xs text-primary-600 mt-1 italic amount-words" id="amount-words"></div>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-600 mb-1 font-medium">Frequency <span class="text-danger-500">*</span></label>
                            <select name="frequency" required class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-slate-800 focus:border-primary-500 text-sm" onchange="updateMonthlyEquivalent()">
                                <option value="MONTHLY">Monthly</option>
                                <option value="QUARTERLY">Quarterly</option>
                                <option value="HALF_YEARLY">Half-Yearly</option>
                                <option value="YEARLY">Yearly</option>
                                <option value="ONE_TIME">One-Time</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-600 mb-1 font-medium">Monthly Equivalent</label>
                            <div class="px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-slate-700 text-sm font-mono" id="monthly-equivalent">‚Çπ0</div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" name="isFixed" checked class="w-4 h-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-slate-700">Fixed Expense (recurring every period)</span>
                        </label>
                        <div class="text-xs text-slate-400 ml-7">Uncheck if this is a variable/occasional expense</div>
                    </div>
                </div>

                <!-- Time-Bound Section -->
                <div class="mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <h4 class="text-sm font-semibold text-purple-700 mb-3 flex items-center gap-2">
                        <span class="w-6 h-6 rounded-full bg-purple-200 text-purple-700 flex items-center justify-center text-xs">2</span>
                        Time-Bound Settings
                        <span class="ml-auto text-xs font-normal text-purple-500">(Optional - for expenses that end at a specific date/age)</span>
                    </h4>
                    <div class="mb-4">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" name="isTimeBound" id="isTimeBound" class="w-4 h-4 rounded border-purple-300 text-purple-600 focus:ring-purple-500" onchange="toggleTimeBoundFields()">
                            <span class="text-sm text-purple-800 font-medium">This expense has an end date (e.g., school fees until child graduates)</span>
                        </label>
                    </div>
                    
                    <div id="timebound-fields" class="hidden space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-purple-700 mb-1 font-medium">Start Date</label>
                                <input type="date" name="startDate" class="w-full px-3 py-2 bg-white border border-purple-300 rounded-lg text-slate-800 focus:border-purple-500 text-sm">
                                <div class="text-xs text-purple-500 mt-1">When did/will this expense start?</div>
                            </div>
                            <div>
                                <label class="block text-sm text-purple-700 mb-1 font-medium">End Date (if known)</label>
                                <input type="date" name="endDate" class="w-full px-3 py-2 bg-white border border-purple-300 rounded-lg text-slate-800 focus:border-purple-500 text-sm">
                                <div class="text-xs text-purple-500 mt-1">Leave blank if based on dependent's age</div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-white rounded-lg border border-purple-200">
                            <div class="text-sm font-medium text-purple-700 mb-3">üë®‚Äçüëß Dependent-Based End (for education expenses)</div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-purple-600 mb-1">Dependent Name</label>
                                    <input type="text" name="dependentName" placeholder="e.g., Rahul" class="w-full px-3 py-2 bg-white border border-purple-200 rounded-lg text-slate-800 focus:border-purple-500 text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm text-purple-600 mb-1">Date of Birth</label>
                                    <input type="date" name="dependentDob" class="w-full px-3 py-2 bg-white border border-purple-200 rounded-lg text-slate-800 focus:border-purple-500 text-sm" onchange="calculateDependentAge()">
                                </div>
                                <div>
                                    <label class="block text-sm text-purple-600 mb-1">End When Age</label>
                                    <input type="number" name="endAge" min="1" max="30" placeholder="18" class="w-full px-3 py-2 bg-white border border-purple-200 rounded-lg text-slate-800 focus:border-purple-500 text-sm">
                                    <div class="text-xs text-purple-500 mt-1">Expense ends when dependent reaches this age</div>
                                </div>
                            </div>
                            <div id="dependent-age-info" class="mt-2 text-xs text-purple-600 hidden"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-purple-700 mb-1 font-medium">Annual Increase % (e.g., fee hikes)</label>
                            <input type="number" name="annualIncreasePercent" min="0" max="50" step="0.5" placeholder="8" class="w-full px-3 py-2 bg-white border border-purple-300 rounded-lg text-slate-800 focus:border-purple-500 text-sm">
                            <div class="text-xs text-purple-500 mt-1">Expected yearly increase (e.g., 8% for school fee hikes)</div>
                        </div>
                    </div>
                </div>

                <!-- Investment Opportunity Preview -->
                <div id="investment-preview" class="hidden mb-6 p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                    <h4 class="text-sm font-semibold text-emerald-700 mb-2 flex items-center gap-2">
                        üí∞ Investment Opportunity Preview
                    </h4>
                    <div class="text-sm text-emerald-600" id="investment-preview-text">
                        When this expense ends, ‚ÇπX/month will be freed up for investment.
                    </div>
                </div>
            </form>
            <div class="flex justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50">
                <button type="button" onclick="closeModal()" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-100">Cancel</button>
                <button type="submit" form="expense-form" class="px-6 py-2 rounded-lg btn-primary">Save Expense</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-6 right-6 bg-white border border-slate-200 rounded-lg px-4 py-3 shadow-lg hidden">
        <div class="flex items-center gap-3"><span id="toast-icon">‚úÖ</span><span id="toast-message" class="text-slate-700">Success!</span></div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/common.js"></script>
    <script src="js/expenses.js"></script>
</body>
</html>
